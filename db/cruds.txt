doctor

//modificar turno

CREATE OR REPLACE FUNCTION public.turno_modificar()
RETURNS integer
LANGUAGE plpgsql
AS $turno_modificar$
DECLARE 
    valor integer;
BEGIN

   	UPDATE public.turno
	SET fky_doc=p1_fky_doc, fky_con=p2_fky_con, fky_dia=p3_fky_dia, ent_tur=p4_ent_tur, sal_tur=p5_sal_tur, est_tur=p6_est_tur
	WHERE cod_tur=p7_cod_tur
	returning cod_tur into valor;
    
    RETURN valor;
END;
$turno_modificar$;


//eliminar turno

CREATE OR REPLACE FUNCTION public.turno_eliminar(p1_cod_tur integer)
RETURNS integer
LANGUAGE plpgsql
AS $turno_eliminar$
DECLARE 
    valor integer;
BEGIN

UPDATE public.turno
	SET est_tur='I'
	WHERE cod_tur=p1_cod_tur
	returning cod_tur into valor;
    
    RETURN valor;
END;
$turno_eliminar$;

//reanudar turno

CREATE OR REPLACE FUNCTION public.turno_reanudar(p1_cod_tur integer)
RETURNS integer
LANGUAGE plpgsql
AS $turno_reanudar$
DECLARE 
    valor integer;
BEGIN

UPDATE public.turno
	SET est_tur='A'
	WHERE cod_tur=p1_cod_tur
	returning cod_tur into valor;
    
    RETURN valor;
END;
$turno_reanudar$;

//reanudar dia_laborable

CREATE OR REPLACE FUNCTION public.dia_laborable_reanudar(p1_cod_dia integer)
RETURNS integer
LANGUAGE plpgsql
AS $dia_laborable_reanudar$
DECLARE 
    valor integer;
BEGIN

UPDATE public.dia_laborable
	SET est_dia='A'
	WHERE cod_dia=p1_cod_dia
	returning cod_dia into valor;
    
    RETURN valor;
END;
$dia_laborable_reanudar$;

//eliminar dia_laborable

CREATE OR REPLACE FUNCTION public.dia_laborable_eliminar(p1_cod_dia integer)
RETURNS integer
LANGUAGE plpgsql
AS $dia_laborable_eliminar$
DECLARE 
    valor integer;
BEGIN

UPDATE public.dia_laborable
	SET est_dia='I'
	WHERE cod_dia=p1_cod_dia
	returning cod_dia into valor;
    
    RETURN valor;
END;
$dia_laborable_eliminar$;


consultorio





//estructura y funcion para ver la tabla dia_laborable

create type public.dia_laborable_estructura as 
    (
        cod_dia integer,
        nom_dia character varying,
        est_dia character
    );

create or replace function public.dia_laborable_listar() returns setof public.dia_laborable_estructura language 'plpgsql' as $dia_laborable$

declare
    fila public.dia_laborable_estructura%rowtype;
begin
    for fila in 
    select * from public.dia_laborable order by cod_dia

loop 
  return next fila;
end loop;

return;
end;
$dia_laborable$

divisa

//vista de la tabla turno
 SELECT t.cod_tur AS turno,
    t.fky_doc,
    d.nom_doc AS doctor,
    d.fky_esp,
    e.nom_esp AS especialidad,
    t.fky_con,
    c.nom_con AS consultorio,
    t.fky_dia,
    dl.nom_dia AS dia,
    t.ent_tur AS desde,
    t.sal_tur AS hasta,
    t.est_tur AS estatus
   FROM turno t
     JOIN doctor d ON d.cod_doc = t.fky_doc
     JOIN especialidad e ON e.cod_esp = d.fky_esp
     JOIN consultorio c ON c.cod_con = t.fky_con
     JOIN dia_laborable dl ON dl.cod_dia = t.fky_dia
  ORDER BY t.cod_tur;

//estructura y funcion para ver la vista turnos

create type public.turnos_estructura as 
    (
        turnos integer,
        fky_doc integer,
		doctor character varying,
        fky_esp integer,
		especialidad character varying,
        fky_con integer,
		consultorio character varying,
        fky_dia integer,
		dia character varying,
        desde character varying,
        hasta character varying,
        estatus character
    );

create or replace function public.turnos_listar() returns setof public.turnos_estructura language 'plpgsql' as $turnos$

declare
    fila public.turnos_estructura%rowtype;
begin
    for fila in 
    select * from public.turnos

loop 
  return next fila;
end loop;

return;
end;
$turnos$

//vista de doctor

select
	d.cod_doc,
	d.nom_doc as doctor,
	d.fky_esp,
	e.nom_esp as especialidad,
	d.est_doc as estatud
from
	public.doctor d
	inner join
	public.especialidad e on e.cod_esp=d.fky_esp
order by d.cod_doc





//funcion para agregar turnos
CREATE OR REPLACE FUNCTION public.turno_agregar(p1_fky_doc integer, p2_fky_con integer, p3_fky_dia integer, p4_ent_tur character varying, p5_sal_tur character varying)
RETURNS integer
LANGUAGE plpgsql
AS $turno_agregar$
DECLARE 
    valor integer;
BEGIN
    INSERT INTO public.turno(
	fky_doc, fky_con, fky_dia, ent_tur, sal_tur)
	VALUES (p1_fky_doc,p2_fky_con,p3_fky_dia,p4_ent_tur,p5_sal_tur)
	returning cod_tur into valor;
    
    RETURN valor;
END;
$turno_agregar$;

//tabla divisa

CREATE TABLE divisiones (
    cod_div serial PRIMARY KEY,
    nom_div character varying,
    val_div numeric,
    fec_div timestamp DEFAULT now(),
    est_div character varying DEFAULT 'A'
);





consultorio

//Eliminar fisico dia_laborable

CREATE OR REPLACE FUNCTION public.dia_laborable_eliminar_definitivo(p1_cod_dia integer)
RETURNS character varying
LANGUAGE plpgsql
AS $dia_laborable_eliminar_definitivo$
DECLARE 
    valor character varying;
BEGIN
    DELETE FROM public.dia_laborable
	where cod_dia=p1_cod_dia
	returning 'hecho' into valor;
    
    RETURN valor;
END;
$dia_laborable_eliminar_definitivo$;

doctor



//Eliminar fisico turno

CREATE OR REPLACE FUNCTION public.turno_eliminar_definitivo(p1_cod_tur integer)
RETURNS character varying
LANGUAGE plpgsql
AS $turno_eliminar_definitivo$
DECLARE 
    valor character varying;
BEGIN
    DELETE FROM public.turno
	where cod_tur=p1_cod_tur
	returning 'hecho' into valor;
    
    RETURN valor;
END;
$turno_eliminar_definitivo$;






doctor